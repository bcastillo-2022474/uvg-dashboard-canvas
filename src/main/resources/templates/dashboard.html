<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .collapsible-content.expanded {
            max-height: 500px;
        }

        .progress-bar {
            background: linear-gradient(90deg, #3B82F6 var(--progress, 0%), #E5E7EB var(--progress, 0%));
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 p-3 md:p-6">
<div class="max-w-7xl mx-auto space-y-4">
    <!-- Header -->
    <div class="flex items-center justify-between">
        <div class="flex items-center space-x-4">
            <div class="h-10 w-10 md:h-12 md:w-12 ring-2 ring-blue-100 rounded-full bg-blue-500 flex items-center justify-center text-white font-semibold">
                JD
            </div>
            <div>
                <h1 class="text-xl md:text-2xl font-bold text-gray-900">Welcome back, <span th:text="${userName ?: 'Student'}">Student</span> ðŸ‘‹</h1>
                <p class="text-sm md:text-base text-gray-600">All your course data in one place</p>
    <!-- Header - Mobile Friendly -->
    <div class="bg-white/70 backdrop-blur-sm rounded-lg p-4 shadow-sm">
        <div class="flex items-start justify-between gap-3">
            <div class="flex items-center gap-3 flex-1 min-w-0">
                <div class="h-12 w-12 md:h-14 md:w-14 ring-2 ring-blue-100 rounded-full bg-blue-500 flex items-center justify-center text-white font-semibold text-lg md:text-xl flex-shrink-0">
                    <span th:text="${userInitials}">JD</span>
                </div>
                <div class="flex-1 min-w-0">
                    <h1 class="text-lg md:text-2xl font-bold text-gray-900 truncate">
                        Welcome back, <span th:text="${userName ?: 'Student'}">Student</span> ðŸ‘‹
                    </h1>
                    <p class="text-xs md:text-sm text-gray-600 truncate">All your course data in one place</p>
                </div>
            </div>
        </div>
        <div class="flex items-center space-x-2">
            <button class="relative bg-transparent h-8 w-8 md:h-10 md:w-10 border border-gray-300 rounded-md flex items-center justify-center hover:bg-gray-50">
                <i data-lucide="bell" class="h-3 w-3 md:h-4 md:w-4"></i>
                <span class="absolute -top-1 -right-1 h-2 w-2 md:h-3 md:w-3 bg-red-500 rounded-full"></span>
            </button>
            <a href="/logout" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-md text-sm font-medium transition duration-150 ease-in-out">
            <a href="/logout" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1.5 md:px-4 md:py-2 rounded-md text-xs md:text-sm font-medium transition duration-150 ease-in-out whitespace-nowrap flex-shrink-0">
                Logout
            </a>
        </div>
                <i data-lucide="target" class="h-4 w-4 md:h-5 md:w-5 text-blue-600"></i>
                <div>
                    <p class="text-xs md:text-sm text-gray-600">Overall</p>
                    <p class="text-lg md:text-2xl font-bold text-blue-600">86.8%</p>
                    <p class="text-lg md:text-2xl font-bold text-blue-600" th:text="${#numbers.formatDecimal(dashboardData.summary.overallPercentage, 1, 1)} + '%'" ></p>
                    <p class="text-xs text-gray-500">Semester</p>
                </div>
            </div>
                <i data-lucide="bar-chart-3" class="h-4 w-4 md:h-5 md:w-5 text-green-600"></i>
                <div>
                    <p class="text-xs md:text-sm text-gray-600">Graded</p>
                    <p class="text-lg md:text-2xl font-bold text-green-600">91.8%</p>
                    <p class="text-xs text-gray-500">1847/2007</p>
                    <p class="text-lg md:text-2xl font-bold text-green-600" th:text="${#numbers.formatDecimal(dashboardData.summary.totalGradedPercentage, 1, 1)} + '%'" ></p>
                    <p class="text-xs text-gray-500" th:text="${dashboardData.summary.totalGradedPoints} + '/' + ${dashboardData.summary.totalGradedPointsPossible}" ></p>
                </div>
            </div>
        </div>
                <i data-lucide="check-circle" class="h-4 w-4 md:h-5 md:w-5 text-purple-600"></i>
                <div>
                    <p class="text-xs md:text-sm text-gray-600">Completed</p>
                    <p class="text-lg md:text-2xl font-bold text-purple-600">50</p>
                    <p class="text-lg md:text-2xl font-bold text-purple-600" th:text="${dashboardData.summary.totalCompletedAssignments}" ></p>
                    <p class="text-xs text-gray-500">assignments</p>
                </div>
            </div>
                <i data-lucide="alert-triangle" class="h-4 w-4 md:h-5 md:w-5 text-orange-600"></i>
                <div>
                    <p class="text-xs md:text-sm text-gray-600">Due Soon</p>
                    <p class="text-lg md:text-2xl font-bold text-orange-600">5</p>
                    <p class="text-lg md:text-2xl font-bold text-orange-600" th:text="${dashboardData.summary.upcomingAssignments}" ></p>
                    <p class="text-xs text-gray-500">this week</p>
                </div>
            </div>
                <div class="space-y-3">
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-gray-600">Tasks Completed</span>
                        <span class="font-semibold">4/5</span>
                        <span class="font-semibold"></span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-blue-600 h-2 rounded-full" style="width: 80%"></div>
                        <div class="bg-blue-600 h-2 rounded-full" style="width: 0%"></div>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-gray-600">Points Earned</span>
                        <span class="font-semibold text-green-600">91 pts</span>
                        <span class="font-semibold text-green-600"></span>
                    </div>
                </div>
            </div>
                    <span>Predicted Grade</span>
                </h3>
            </div>
            <div class="text-center p-4 pt-0">
                <div class="text-3xl font-bold text-green-600 mb-2">87%</div>
                <span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded">
                        On Track for B+
                    </span>
            <div th:if="${predictionData.isPredictionAvailable()}" class="text-center p-4 pt-0">
                <div class="text-3xl font-bold text-green-600 mb-2" th:text="${#numbers.formatDecimal(predictionData.predictedScore, 1, 1)} + '%'" ></div>
                <span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded" th:text="'On Track for ' + ${predictionData.predictedLetterGrade}"></span>
            </div>
            <div th:if="${!predictionData.isPredictionAvailable()}" class="text-center p-4 pt-0">
                <p class="text-sm text-gray-600 p-4">Not enough data to make a prediction.</p>
            </div>
        </div>

            <div class="p-4 pt-0 space-y-3">
                <div class="flex justify-between items-center">
                    <span class="text-sm text-gray-600">Total Semester</span>
                    <span class="font-semibold">1847/2127</span>
                    <span class="font-semibold" th:text="${dashboardData.summary.totalGradedPoints} + '/' + ${dashboardData.summary.totalSemesterPointsPossible}"></span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-sm text-gray-600">Graded Only</span>
                    <span class="font-semibold text-green-600">1847/2007</span>
                    <span class="font-semibold text-green-600" th:text="${dashboardData.summary.totalGradedPoints} + '/' + ${dashboardData.summary.totalGradedPointsPossible}"></span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-sm text-gray-600">Remaining</span>
                    <span class="font-semibold text-blue-600">280</span>
                    <span class="font-semibold text-blue-600" th:text="${dashboardData.summary.totalUpcomingPoints}"></span>
                </div>
            </div>
        </div>

    <!-- Course Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4">
        <!-- Environmental Science -->
        <div class="shadow-sm border-0 bg-white/80 backdrop-blur-sm hover:bg-white/90 hover:scale-101 transition-all duration-200 rounded-lg">
            <div class="p-4 pb-3">
                <div class="flex items-start justify-between">
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 rounded-full bg-green-500"></div>
                        <div>
                            <h3 class="font-semibold text-sm md:text-base text-gray-900 leading-tight">Environmental
                                Science</h3>
                            <p class="text-xs text-gray-600">ENVS 201</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <span class="bg-gray-100 text-gray-800 text-sm px-2 py-1 rounded">B+</span>
                        <div class="flex items-center mt-1">
                            <span class="text-lg font-bold text-blue-600">87.7%</span>
                            <i data-lucide="trending-up" class="h-3 w-3 text-green-500 ml-1"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="p-4 pt-0 space-y-4">
                <!-- Points Summary -->
                <div class="grid grid-cols-2 gap-3 text-xs">
                    <div class="bg-blue-50 p-2 rounded">
                        <p class="text-blue-600 font-medium">Semester Points</p>
                        <p class="font-bold text-blue-800">456/520</p>
                        <p class="text-blue-600">87.7%</p>
                    </div>
                    <div class="bg-green-50 p-2 rounded">
                        <p class="text-green-600 font-medium">Graded Points</p>
                        <p class="font-bold text-green-800">456/460</p>
                        <p class="text-green-600">99.1%</p>
                    </div>
                </div>

                <!-- Quick Stats Grid -->
                <div class="grid grid-cols-2 gap-2 text-xs">
                    <div class="bg-purple-50 p-2 rounded text-center">
                        <p class="text-purple-600 font-medium">Class Avg</p>
                        <p class="font-bold text-purple-800">82.3%</p>
                    </div>
                    <div class="bg-orange-50 p-2 rounded text-center">
                        <p class="text-orange-600 font-medium">Assignments</p>
                        <p class="font-bold text-orange-800">11/12</p>
                    </div>
                </div>

                <!-- Collapsible Recent Grades -->
                <div>
                    <button onclick="toggleGrades('envs')"
                            class="w-full justify-between p-2 h-auto text-left hover:bg-gray-50 rounded flex items-center">
                        <span class="text-xs font-semibold text-gray-700">Recent Grades (5)</span>
                        <i data-lucide="chevron-down" class="h-3 w-3" id="envs-chevron"></i>
                    </button>
                    <div id="envs-grades" class="collapsible-content space-y-1 mt-2">
                        <div class="flex justify-between items-center text-xs bg-gray-50 p-2 rounded">
                            <div class="flex-1 mr-2">
                                <span class="truncate block">Lab Report #3</span>
                                <span class="text-gray-500">Jan 15</span>
                            </div>
                            <div class="text-right">
                                <span class="font-semibold text-green-600">92%</span>
                                <p class="text-gray-500">46/50</p>
                            </div>
                        </div>
                        <div class="flex justify-between items-center text-xs bg-gray-50 p-2 rounded">
                            <div class="flex-1 mr-2">
                                <span class="truncate block">Quiz #4</span>
                                <span class="text-gray-500">Jan 12</span>
                            </div>
                            <div class="text-right">
                                <span class="font-semibold text-blue-600">88%</span>
                                <p class="text-gray-500">22/25</p>
                            </div>
                        </div>
                        <div class="flex justify-between items-center text-xs bg-gray-50 p-2 rounded">
                            <div class="flex-1 mr-2">
                                <span class="truncate block">Discussion Post</span>
                                <span class="text-gray-500">Jan 10</span>
                            </div>
                            <div class="text-right">
                                <span class="font-semibold text-green-600">95%</span>
                                <p class="text-gray-500">19/20</p>
                            </div>
                        </div>
                    </div>
                </div>
<!-- Dynamic Course Cards -->
<div th:each="courseCard, iterStat : ${dashboardData.courseCards}"
     class="shadow-sm border-0 bg-white/80 backdrop-blur-sm hover:bg-white/90 hover:scale-101 transition-all duration-200 rounded-lg">

                <!-- Category Breakdown -->
    <!-- Course Header -->
    <div class="p-4 pb-3">
        <div class="flex items-start justify-between">
            <div class="flex items-center space-x-2">
                <div class="w-3 h-3 rounded-full bg-blue-500"></div>
                <div>
                    <h4 class="text-xs font-semibold text-gray-700 mb-2">Grade Categories</h4>
                    <div class="space-y-1">
                        <div class="flex justify-between items-center text-xs">
                            <span class="text-gray-600">Exams (40%)</span>
                            <div class="text-right">
                                <span class="font-medium">84%</span>
                                <p class="text-gray-500">168/200</p>
                            </div>
                        </div>
                        <div class="flex justify-between items-center text-xs">
                            <span class="text-gray-600">Labs (30%)</span>
                            <div class="text-right">
                                <span class="font-medium">89%</span>
                                <p class="text-gray-500">142/160</p>
                            </div>
                        </div>
                    </div>
                    <h3 class="font-semibold text-sm md:text-base text-gray-900 leading-tight"
                        th:text="${courseCard.courseWithGrades.course.name}"></h3>
                    <p class="text-xs text-gray-600"
                       th:text="${courseCard.courseWithGrades.course.code}"></p>
                </div>

                <!-- Upcoming Assignments -->
                <div>
                    <h4 class="text-xs font-semibold text-gray-700 mb-2">Due Soon</h4>
                    <div class="space-y-1">
                        <div class="flex items-center justify-between text-xs bg-amber-50 p-2 rounded border border-amber-200">
                            <div class="flex items-center space-x-1">
                                <i data-lucide="award" class="h-3 w-3"></i>
                                <span class="truncate">Midterm Exam</span>
                            </div>
                            <div class="text-right">
                                <p class="font-medium text-amber-800">Jan 22</p>
                                <p class="text-amber-600">100 pts</p>
                            </div>
                        </div>
                    </div>
            </div>
            <div class="text-right">
                <span class="bg-gray-100 text-gray-800 text-sm px-2 py-1 rounded"
                      th:text="${courseCard.courseWithGrades.enrollment.currentGrade}"></span>
                <div class="flex items-center mt-1">
                    <span class="text-lg font-bold text-blue-600"
                          th:text="${#numbers.formatDecimal(courseCard.courseWithGrades.enrollment.currentScore, 1, 1)} + '%'" ></span>
                    <i th:data-lucide="${courseCard.trend == 'up' ? 'trending-up' : (courseCard.trend == 'down' ? 'trending-down' : 'minus')}"
                       th:class="${'h-3 w-3 ml-1 ' + (courseCard.trend == 'up' ? 'text-green-500' : (courseCard.trend == 'down' ? 'text-red-500' : 'text-gray-400'))}"
                       class="h-3 w-3 text-green-500 ml-1"></i>
                </div>
            </div>
        </div>
    </div>

        <!-- Mathematics 201 -->
        <div class="shadow-sm border-0 bg-white/80 backdrop-blur-sm hover:bg-white/90 hover:scale-101 transition-all duration-200 rounded-lg">
            <div class="p-4 pb-3">
                <div class="flex items-start justify-between">
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 rounded-full bg-blue-500"></div>
                        <div>
                            <h3 class="font-semibold text-sm md:text-base text-gray-900 leading-tight">Mathematics
                                201</h3>
                            <p class="text-xs text-gray-600">MATH 201</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <span class="bg-gray-100 text-gray-800 text-sm px-2 py-1 rounded">A-</span>
                        <div class="flex items-center mt-1">
                            <span class="text-lg font-bold text-green-600">90.0%</span>
                            <i data-lucide="trending-up" class="h-3 w-3 text-green-500 ml-1"></i>
                        </div>
                    </div>
                </div>
    <div class="p-4 pt-0 space-y-4">
        <!-- Points Summary (removed semester points to simplify) -->
        <div class="grid grid-cols-2 gap-3 text-xs">
            <div class="bg-blue-50 p-2 rounded">
                <p class="text-blue-600 font-medium">Current Score</p>
                <p class="font-bold text-blue-800"
                   th:text="${#numbers.formatDecimal(courseCard.courseWithGrades.enrollment.currentScore, 1, 1)} + '%'" ></p>
            </div>

            <div class="p-4 pt-0 space-y-4">
                <!-- Points Summary -->
                <div class="grid grid-cols-2 gap-3 text-xs">
                    <div class="bg-blue-50 p-2 rounded">
                        <p class="text-blue-600 font-medium">Semester Points</p>
                        <p class="font-bold text-blue-800">378/420</p>
                        <p class="text-blue-600">90.0%</p>
                    </div>
                    <div class="bg-green-50 p-2 rounded">
                        <p class="text-green-600 font-medium">Graded Points</p>
                        <p class="font-bold text-green-800">378/380</p>
                        <p class="text-green-600">99.5%</p>
                    </div>
                </div>

                <!-- Quick Stats Grid -->
                <div class="grid grid-cols-2 gap-2 text-xs">
                    <div class="bg-purple-50 p-2 rounded text-center">
                        <p class="text-purple-600 font-medium">Class Avg</p>
                        <p class="font-bold text-purple-800">78.5%</p>
                    </div>
                    <div class="bg-orange-50 p-2 rounded text-center">
                        <p class="text-orange-600 font-medium">Assignments</p>
                        <p class="font-bold text-orange-800">9/10</p>
                    </div>
                </div>

                <!-- Grade Categories -->
                <div>
                    <h4 class="text-xs font-semibold text-gray-700 mb-2">Grade Categories</h4>
                    <div class="space-y-1">
                        <div class="flex justify-between items-center text-xs">
                            <span class="text-gray-600">Exams (50%)</span>
                            <div class="text-right">
                                <span class="font-medium">90%</span>
                                <p class="text-gray-500">180/200</p>
                            </div>
                        </div>
                        <div class="flex justify-between items-center text-xs">
                            <span class="text-gray-600">Homework (30%)</span>
                            <div class="text-right">
                                <span class="font-medium">92%</span>
                                <p class="text-gray-500">138/150</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Upcoming Assignments -->
                <div>
                    <h4 class="text-xs font-semibold text-gray-700 mb-2">Due Soon</h4>
                    <div class="space-y-1">
                        <div class="flex items-center justify-between text-xs bg-amber-50 p-2 rounded border border-amber-200">
                            <div class="flex items-center space-x-1">
                                <i data-lucide="book-open" class="h-3 w-3"></i>
                                <span class="truncate">Problem Set #9</span>
                            </div>
                            <div class="text-right">
                                <p class="font-medium text-amber-800">Jan 20</p>
                                <p class="text-amber-600">40 pts</p>
                            </div>
                        </div>
                    </div>
                </div>
            <div class="bg-gray-50 p-2 rounded">
                <p class="text-gray-600 font-medium">Remaining</p>
                <p class="font-bold text-gray-800" th:text="${#numbers.formatDecimal(courseCard.remainingPoints, 1, 0)} + '%'"></p>
            </div>
        </div>

        <!-- Spanish III -->
        <div class="shadow-sm border-0 bg-white/80 backdrop-blur-sm hover:bg-white/90 hover:scale-101 transition-all duration-200 rounded-lg">
            <div class="p-4 pb-3">
                <div class="flex items-start justify-between">
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 rounded-full bg-purple-500"></div>
                        <div>
                            <h3 class="font-semibold text-sm md:text-base text-gray-900 leading-tight">Spanish III</h3>
                            <p class="text-xs text-gray-600">SPAN 301</p>
                        </div>
        <!-- Recent Grades -->
        <div th:if="${!courseCard.recentGrades.isEmpty()}">
            <button th:onclick="'toggleGrades(\'course-' + ${iterStat.index} + '\')'"
                    class="w-full justify-between p-2 h-auto text-left hover:bg-gray-50 rounded flex items-center">
                <span class="text-xs font-semibold text-gray-700"
                      th:text="'Recent Grades (' + ${courseCard.recentGrades.size()} + ')'"></span>
                <i data-lucide="chevron-down" class="h-3 w-3" th:id="'course-' + ${iterStat.index} + '-chevron'"></i>
            </button>
            <div th:id="'course-' + ${iterStat.index} + '-grades'" class="collapsible-content space-y-1 mt-2">
                <div th:each="recentGrade : ${courseCard.recentGrades}"
                     class="flex justify-between items-center text-xs bg-gray-50 p-2 rounded">
                    <div class="flex-1 mr-2">
                        <span class="truncate block" th:text="${recentGrade.assignment.name}"></span>
                        <span class="text-gray-500"
                              th:text="${recentGrade.submission.gradedAt != null ? #temporals.format(recentGrade.submission.gradedAt, 'MMM dd') : 'N/A'}"></span>
                    </div>
                    <div class="text-right">
                        <span class="bg-gray-100 text-gray-800 text-sm px-2 py-1 rounded">A</span>
                        <div class="flex items-center mt-1">
                            <span class="text-lg font-bold text-green-600">95.0%</span>
                            <i data-lucide="trending-up" class="h-3 w-3 text-green-500 ml-1"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="p-4 pt-0 space-y-4">
                <!-- Points Summary -->
                <div class="grid grid-cols-2 gap-3 text-xs">
                    <div class="bg-blue-50 p-2 rounded">
                        <p class="text-blue-600 font-medium">Semester Points</p>
                        <p class="font-bold text-blue-800">342/360</p>
                        <p class="text-blue-600">95.0%</p>
                    </div>
                    <div class="bg-green-50 p-2 rounded">
                        <p class="text-green-600 font-medium">Graded Points</p>
                        <p class="font-bold text-green-800">342/342</p>
                        <p class="text-green-600">100%</p>
                    </div>
                </div>

                <!-- Quick Stats Grid -->
                <div class="grid grid-cols-2 gap-2 text-xs">
                    <div class="bg-purple-50 p-2 rounded text-center">
                        <p class="text-purple-600 font-medium">Class Avg</p>
                        <p class="font-bold text-purple-800">88.2%</p>
                    </div>
                    <div class="bg-orange-50 p-2 rounded text-center">
                        <p class="text-orange-600 font-medium">Assignments</p>
                        <p class="font-bold text-orange-800">8/8</p>
                    </div>
                </div>

                <!-- Grade Categories -->
                <div>
                    <h4 class="text-xs font-semibold text-gray-700 mb-2">Grade Categories</h4>
                    <div class="space-y-1">
                        <div class="flex justify-between items-center text-xs">
                            <span class="text-gray-600">Oral (25%)</span>
                            <div class="text-right">
                                <span class="font-medium">95%</span>
                                <p class="text-gray-500">95/100</p>
                            </div>
                        </div>
                        <div class="flex justify-between items-center text-xs">
                            <span class="text-gray-600">Written (35%)</span>
                            <div class="text-right">
                                <span class="font-medium">95%</span>
                                <p class="text-gray-500">142/150</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-green-50 border border-green-200 p-2 rounded">
                    <div class="flex items-center space-x-1">
                        <i data-lucide="check-circle" class="h-3 w-3 text-green-500"></i>
                        <span class="text-xs text-green-800 font-medium">All assignments up to date!</span>
                        <span class="font-semibold text-green-600"
                              th:text="${recentGrade.submission.score != null and recentGrade.assignment.pointsPossible > 0 ? #numbers.formatDecimal((recentGrade.submission.score / recentGrade.assignment.pointsPossible) * 100, 1, 0) + '%' : 'N/A'}"></span>
                        <p class="text-gray-500"
                           th:text="${recentGrade.submission.score != null ? recentGrade.submission.score : '-'} + '/' + ${recentGrade.assignment.pointsPossible}"></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chemistry 101 -->
        <div class="shadow-sm border-0 bg-white/80 backdrop-blur-sm hover:bg-white/90 hover:scale-101 transition-all duration-200 rounded-lg">
            <div class="p-4 pb-3">
                <div class="flex items-start justify-between">
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 rounded-full bg-orange-500"></div>
                        <div>
                            <h3 class="font-semibold text-sm md:text-base text-gray-900 leading-tight">Chemistry
                                101</h3>
                            <p class="text-xs text-gray-600">CHEM 101</p>
                        </div>
                    </div>
        <!-- Category Breakdown -->
        <div th:if="${!courseCard.categoryBreakdown.isEmpty()}">
            <h4 class="text-xs font-semibold text-gray-700 mb-2">Grade Categories</h4>
            <div class="space-y-1">
                <div th:each="category : ${courseCard.categoryBreakdown}"
                     class="flex justify-between items-center text-xs">
                    <span class="text-gray-600"
                          th:text="${category.group.name} + ' (' + ${#numbers.formatDecimal(category.group.groupWeight, 1, 0)} + '%)'"></span>
                    <div class="text-right">
                        <span class="bg-gray-100 text-gray-800 text-sm px-2 py-1 rounded">C+</span>
                        <div class="flex items-center mt-1">
                            <span class="text-lg font-bold text-yellow-600">78.4%</span>
                            <i data-lucide="trending-down" class="h-3 w-3 text-red-500 ml-1"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="p-4 pt-0 space-y-4">
                <!-- Points Summary -->
                <div class="grid grid-cols-2 gap-3 text-xs">
                    <div class="bg-blue-50 p-2 rounded">
                        <p class="text-blue-600 font-medium">Semester Points</p>
                        <p class="font-bold text-blue-800">298/380</p>
                        <p class="text-blue-600">78.4%</p>
                    </div>
                    <div class="bg-green-50 p-2 rounded">
                        <p class="text-green-600 font-medium">Graded Points</p>
                        <p class="font-bold text-green-800">298/320</p>
                        <p class="text-green-600">93.1%</p>
                    </div>
                </div>

                <!-- Quick Stats Grid -->
                <div class="grid grid-cols-2 gap-2 text-xs">
                    <div class="bg-purple-50 p-2 rounded text-center">
                        <p class="text-purple-600 font-medium">Class Avg</p>
                        <p class="font-bold text-purple-800">81.7%</p>
                    </div>
                    <div class="bg-orange-50 p-2 rounded text-center">
                        <p class="text-orange-600 font-medium">Assignments</p>
                        <p class="font-bold text-orange-800">12/14</p>
                    </div>
                </div>

                <!-- Grade Categories -->
                <div>
                    <h4 class="text-xs font-semibold text-gray-700 mb-2">Grade Categories</h4>
                    <div class="space-y-1">
                        <div class="flex justify-between items-center text-xs">
                            <span class="text-gray-600">Exams (45%)</span>
                            <div class="text-right">
                                <span class="font-medium">73%</span>
                                <p class="text-gray-500">145/200</p>
                            </div>
                        </div>
                        <div class="flex justify-between items-center text-xs">
                            <span class="text-gray-600">Labs (30%)</span>
                            <div class="text-right">
                                <span class="font-medium">82%</span>
                                <p class="text-gray-500">98/120</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Upcoming Assignments -->
                <div>
                    <h4 class="text-xs font-semibold text-gray-700 mb-2">Due Soon</h4>
                    <div class="space-y-1">
                        <div class="flex items-center justify-between text-xs bg-amber-50 p-2 rounded border border-amber-200">
                            <div class="flex items-center space-x-1">
                                <i data-lucide="file-text" class="h-3 w-3"></i>
                                <span class="truncate">Lab Report #5</span>
                            </div>
                            <div class="text-right">
                                <p class="font-medium text-amber-800">Jan 19</p>
                                <p class="text-amber-600">40 pts</p>
                            </div>
                        </div>
                        <div class="flex items-center justify-between text-xs bg-amber-50 p-2 rounded border border-amber-200">
                            <div class="flex items-center space-x-1">
                                <i data-lucide="award" class="h-3 w-3"></i>
                                <span class="truncate">Midterm Exam</span>
                            </div>
                            <div class="text-right">
                                <p class="font-medium text-amber-800">Jan 25</p>
                                <p class="text-amber-600">100 pts</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Alerts -->
                <div class="bg-red-50 border border-red-200 p-2 rounded">
                    <div class="flex items-center space-x-1">
                        <i data-lucide="x-circle" class="h-3 w-3 text-red-500"></i>
                        <span class="text-xs text-red-800 font-medium">1 missed assignment</span>
                    </div>
                </div>

                <div class="bg-yellow-50 border border-yellow-200 p-2 rounded">
                    <div class="flex items-center space-x-1">
                        <i data-lucide="alert-triangle" class="h-3 w-3 text-yellow-500"></i>
                        <span class="text-xs text-yellow-800 font-medium">Below class average by 3.3%</span>
                        <span class="font-medium"
                              th:text="${#numbers.formatDecimal(category.currentScore, 1, 0)} + '%'" ></span>
                        <p class="text-gray-500"
                           th:text="${category.pointsEarned} + '/' + ${category.pointsTotal}"></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Physics 201 -->
        <div class="shadow-sm border-0 bg-white/80 backdrop-blur-sm hover:bg-white/90 hover:scale-101 transition-all duration-200 rounded-lg">
            <div class="p-4 pb-3">
                <div class="flex items-start justify-between">
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 rounded-full bg-red-500"></div>
                        <div>
                            <h3 class="font-semibold text-sm md:text-base text-gray-900 leading-tight">Physics 201</h3>
                            <p class="text-xs text-gray-600">PHYS 201</p>
                        </div>
        <!-- Upcoming Assignments -->
        <div th:if="${!courseCard.upcomingAssignments.isEmpty()}">
            <h4 class="text-xs font-semibold text-gray-700 mb-2">Due Soon</h4>
            <div class="space-y-1">
                <div th:each="assignment : ${courseCard.upcomingAssignments}"
                     class="flex items-center justify-between text-xs bg-amber-50 p-2 rounded border border-amber-200">
                    <div class="flex items-center space-x-1">
                        <i data-lucide="file-text" class="h-3 w-3"></i>
                        <span class="truncate" th:text="${assignment.name}"></span>
                    </div>
                    <div class="text-right">
                        <span class="bg-gray-100 text-gray-800 text-sm px-2 py-1 rounded">B+</span>
                        <div class="flex items-center mt-1">
                            <span class="text-lg font-bold text-blue-600">88.8%</span>
                            <i data-lucide="trending-up" class="h-3 w-3 text-green-500 ml-1"></i>
                        </div>
                        <p class="font-medium text-amber-800"
                           th:text="${assignment.dueAt != null ? #temporals.format(assignment.dueAt, 'MMM dd') : 'No due date'}"></p>
                        <p class="text-amber-600"
                           th:text="${assignment.pointsPossible} + ' pts'"></p>
                    </div>
                </div>
            </div>
        </div>

            <div class="p-4 pt-0 space-y-4">
                <!-- Points Summary -->
                <div class="grid grid-cols-2 gap-3 text-xs">
                    <div class="bg-blue-50 p-2 rounded">
                        <p class="text-blue-600 font-medium">Semester Points</p>
                        <p class="font-bold text-blue-800">373/420</p>
                        <p class="text-blue-600">88.8%</p>
                    </div>
                    <div class="bg-green-50 p-2 rounded">
                        <p class="text-green-600 font-medium">Graded Points</p>
                        <p class="font-bold text-green-800">373/385</p>
                        <p class="text-green-600">96.9%</p>
                    </div>
                </div>

                <!-- Quick Stats Grid -->
                <div class="grid grid-cols-2 gap-2 text-xs">
                    <div class="bg-purple-50 p-2 rounded text-center">
                        <p class="text-purple-600 font-medium">Class Avg</p>
                        <p class="font-bold text-purple-800">84.1%</p>
                    </div>
                    <div class="bg-orange-50 p-2 rounded text-center">
                        <p class="text-orange-600 font-medium">Assignments</p>
                        <p class="font-bold text-orange-800">10/11</p>
                    </div>
                </div>

                <!-- Grade Categories -->
                <div>
                    <h4 class="text-xs font-semibold text-gray-700 mb-2">Grade Categories</h4>
                    <div class="space-y-1">
                        <div class="flex justify-between items-center text-xs">
                            <span class="text-gray-600">Exams (40%)</span>
                            <div class="text-right">
                                <span class="font-medium">83%</span>
                                <p class="text-gray-500">165/200</p>
                            </div>
                        </div>
                        <div class="flex justify-between items-center text-xs">
                            <span class="text-gray-600">Labs (35%)</span>
                            <div class="text-right">
                                <span class="font-medium">91%</span>
                                <p class="text-gray-500">128/140</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Upcoming Assignments -->
                <div>
                    <h4 class="text-xs font-semibold text-gray-700 mb-2">Due Soon</h4>
                    <div class="space-y-1">
                        <div class="flex items-center justify-between text-xs bg-amber-50 p-2 rounded border border-amber-200">
                            <div class="flex items-center space-x-1">
                                <i data-lucide="file-text" class="h-3 w-3"></i>
                                <span class="truncate">Lab Report #3</span>
                            </div>
                            <div class="text-right">
                                <p class="font-medium text-amber-800">Jan 21</p>
                                <p class="text-amber-600">35 pts</p>
                            </div>
                        </div>
                    </div>
                </div>
        <!-- No upcoming assignments message -->
        <div th:if="${courseCard.upcomingAssignments.isEmpty()}"
             class="bg-green-50 border border-green-200 p-2 rounded">
            <div class="flex items-center space-x-1">
                <i data-lucide="check-circle" class="h-3 w-3 text-green-500"></i>
                <span class="text-xs text-green-800 font-medium">No upcoming assignments!</span>
            </div>
        </div>
    </div>
</div>
    </div>

    <!-- Grade Progression Chart -->
    <div class="shadow-sm border-0 bg-white/70 backdrop-blur-sm rounded-lg">
    <div class="shadow-sm border-0 bg-white/70 backdrop-blur-sm rounded-lg" th:if="${predictionData.isPredictionAvailable()}">
        <div class="p-4 pb-3">
            <h3 class="text-lg font-semibold flex items-center space-x-2">
                <i data-lucide="trending-up" class="h-5 w-5 text-purple-600"></i>
            </h3>
            <p class="text-sm text-gray-600">Your academic performance trend over time</p>
        </div>
        <div class="p-4 pt-0">
            <div class="h-[300px] flex items-end justify-between space-x-2">
                <div class="flex flex-col items-center space-y-2 flex-1">
                    <div class="w-full bg-purple-200 rounded-t" style="height: 170px;"></div>
                    <span class="text-xs text-gray-600">Week 1</span>
                    <span class="text-xs font-semibold">85%</span>
                </div>
                <div class="flex flex-col items-center space-y-2 flex-1">
                    <div class="w-full bg-purple-300 rounded-t" style="height: 204px;"></div>
                    <span class="text-xs text-gray-600">Week 2</span>
                    <span class="text-xs font-semibold">88%</span>
                </div>
                <div class="flex flex-col items-center space-y-2 flex-1">
                    <div class="w-full bg-purple-200 rounded-t" style="height: 136px;"></div>
                    <span class="text-xs text-gray-600">Week 3</span>
                    <span class="text-xs font-semibold">82%</span>
                </div>
                <div class="flex flex-col items-center space-y-2 flex-1">
                    <div class="w-full bg-purple-400 rounded-t" style="height: 238px;"></div>
                    <span class="text-xs text-gray-600">Week 4</span>
                    <span class="text-xs font-semibold">90%</span>
                </div>
                <div class="flex flex-col items-center space-y-2 flex-1">
                    <div class="w-full bg-purple-300 rounded-t" style="height: 187px;"></div>
                    <span class="text-xs text-gray-600">Week 5</span>
                    <span class="text-xs font-semibold">87%</span>
                </div>
                <div class="flex flex-col items-center space-y-2 flex-1">
                    <div class="w-full bg-purple-400 rounded-t" style="height: 221px;"></div>
                    <span class="text-xs text-gray-600">Week 6</span>
                    <span class="text-xs font-semibold">89%</span>
                </div>
                <div class="flex flex-col items-center space-y-2 flex-1">
                    <div class="w-full bg-purple-500 rounded-t" style="height: 255px;"></div>
                    <span class="text-xs text-gray-600">Week 7</span>
                    <span class="text-xs font-semibold">91%</span>
                </div>
                <div class="flex flex-col items-center space-y-2 flex-1">
                    <div class="w-full bg-purple-300 rounded-t" style="height: 187px;"></div>
                    <span class="text-xs text-gray-600">Week 8</span>
                    <span class="text-xs font-semibold">87%</span>
                </div>
            </div>
        <div class="p-4 pt-0 overflow-x-auto">
            <svg id="progressionChart" class="h-[300px]" preserveAspectRatio="none">
                <!-- Gradient for area under line -->
                <defs>
                    <linearGradient id="lineGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#9333ea;stop-opacity:0.2" />
                        <stop offset="100%" style="stop-color:#9333ea;stop-opacity:0" />
                    </linearGradient>
                </defs>

                <!-- Grid lines (will be added dynamically) -->
                <g id="gridLines"></g>

                <!-- Y-axis labels (will be added dynamically) -->
                <g id="yAxisLabels"></g>

                <!-- Area fill -->
                <polygon id="areaFill" fill="url(#lineGradient)"/>

                <!-- The line -->
                <polyline id="trendLine" stroke="#9333ea" stroke-width="3" fill="none" stroke-linecap="round" stroke-linejoin="round"/>

                <!-- Data points -->
                <g id="dataPoints"></g>
            </svg>

            <script th:inline="javascript">
                /*<![CDATA[*/
                (function() {
                    const data = /*[[${predictionData.gradeProgression}]]*/ [];
                    if (!data || data.length === 0) return;

                    const svg = document.getElementById('progressionChart');
                    const trendLine = document.getElementById('trendLine');
                    const areaFill = document.getElementById('areaFill');
                    const dataPointsGroup = document.getElementById('dataPoints');
                    const gridLines = document.getElementById('gridLines');
                    const yAxisLabels = document.getElementById('yAxisLabels');

                    // Configuration
                    const leftMargin = 60;
                    const rightMargin = 20;
                    const topMargin = 30;
                    const bottomMargin = 40;
                    const pointSpacing = 80; // More space between points for readability
                    const chartHeight = 300;

                    // Calculate dynamic width based on number of data points
                    const chartWidth = leftMargin + (data.length * pointSpacing) + rightMargin;
                    svg.setAttribute('width', chartWidth);
                    svg.setAttribute('height', chartHeight);
                    svg.setAttribute('viewBox', `0 0 ${chartWidth} ${chartHeight}`);

                    // Find min and max values with padding
                    const scores = data.map(d => d.score);
                    const minScore = Math.max(0, Math.min(...scores) - 5); // Don't go below 0, add 5% padding
                    const maxScore = Math.min(100, Math.max(...scores) + 5); // Don't go above 100, add 5% padding
                    const scoreRange = maxScore - minScore;

                    // Chart dimensions
                    const plotHeight = chartHeight - topMargin - bottomMargin;
                    const plotWidth = chartWidth - leftMargin - rightMargin;
                    const plotTop = topMargin;
                    const plotBottom = chartHeight - bottomMargin;

                    // Create 5 grid lines and labels
                    for (let i = 0; i <= 4; i++) {
                        const value = minScore + (scoreRange * i / 4);
                        const y = plotBottom - (plotHeight * i / 4);

                        // Grid line
                        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                        line.setAttribute('x1', leftMargin);
                        line.setAttribute('y1', y);
                        line.setAttribute('x2', chartWidth - rightMargin);
                        line.setAttribute('y2', y);
                        line.setAttribute('stroke', '#e5e7eb');
                        line.setAttribute('stroke-width', '1');
                        gridLines.appendChild(line);

                        // Y-axis label
                        const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                        label.setAttribute('x', leftMargin - 10);
                        label.setAttribute('y', y + 4);
                        label.setAttribute('font-size', '12');
                        label.setAttribute('fill', '#6b7280');
                        label.setAttribute('text-anchor', 'end');
                        label.textContent = Math.round(value) + '%';
                        yAxisLabels.appendChild(label);
                    }

                    // Calculate coordinates for data points
                    const points = [];
                    data.forEach((point, index) => {
                        const x = leftMargin + (index * pointSpacing);
                        const normalizedScore = (point.score - minScore) / scoreRange;
                        const y = plotBottom - (normalizedScore * plotHeight);
                        points.push({ x, y, label: point.label, score: point.score });
                    });

                    // Build polyline points string
                    const linePoints = points.map(p => `${p.x},${p.y}`).join(' ');
                    trendLine.setAttribute('points', linePoints);

                    // Build polygon for filled area
                    const areaPoints = `${leftMargin},${plotBottom} ${linePoints} ${points[points.length-1].x},${plotBottom}`;
                    areaFill.setAttribute('points', areaPoints);

                    // Add circles and labels
                    points.forEach((p, index) => {
                        // Circle
                        const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                        circle.setAttribute('cx', p.x);
                        circle.setAttribute('cy', p.y);
                        circle.setAttribute('r', '5');
                        circle.setAttribute('fill', '#9333ea');
                        circle.setAttribute('stroke', 'white');
                        circle.setAttribute('stroke-width', '2');
                        dataPointsGroup.appendChild(circle);

                        // X-axis label
                        const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                        label.setAttribute('x', p.x);
                        label.setAttribute('y', plotBottom + 20);
                        label.setAttribute('font-size', '11');
                        label.setAttribute('fill', '#6b7280');
                        label.setAttribute('text-anchor', 'middle');
                        label.textContent = p.label;
                        dataPointsGroup.appendChild(label);

                        // Value label
                        const valueLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                        valueLabel.setAttribute('x', p.x);
                        valueLabel.setAttribute('y', p.y - 10);
                        valueLabel.setAttribute('font-size', '12');
                        valueLabel.setAttribute('fill', '#9333ea');
                        valueLabel.setAttribute('text-anchor', 'middle');
                        valueLabel.setAttribute('font-weight', '600');
                        valueLabel.textContent = Math.round(p.score) + '%';
                        dataPointsGroup.appendChild(valueLabel);
                    });
                })();
                /*]]>*/
            </script>
        </div>
    </div>
</div>